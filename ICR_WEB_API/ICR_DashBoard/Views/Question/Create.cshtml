<h2>Create Question</h2>

<form id="questionForm" class="row">

	<div class="row">
		<div class="col">
			<button type="button" onclick="submitForm()" class="btn btn-primary">Submit Question</button>
		</div>
	</div>
	<div class="row">
		<div class="form-section col">
			<label for="text" class="form-label">Text:</label><br>
			<input type="text" id="text" name="text" class="form-control form-text" required>
		</div>

		<div class="form-section col">
			<label for="sortOrder" class="form-label">Sort Order:</label><br>
			<input type="text" id="sortOrder" name="sortOrder" class="form-control form-text" required>
		</div>

		<div class="form-section col">
			<label for="type" class="form-label">Type:</label><br>
			<select id="type" name="type" class="form-control" required>
				<option value="">Select Type</option>
				<option value="0">Select</option>
				<option value="1">Checkbox</option>
				<option value="2">Rating</option>
				<option value="3">Text</option>
			</select>
		</div>

		<div class="form-section col">
			<label for="isShowable" class="form-label">Question Status:</label><br>
			<input type="radio" id="showQuestion" name="isShowable" checked value="1" />
			<label for="showQuestion" class="form-label">Show</label>

			<input type="radio" id="hideQuestion" name="isShowable" value="0" />
			<label for="hideQuestion" class="form-label">Hide</label>
		</div>
	</div>

	<div class="row">
		<div class="form-section col">
			<label class="form-label">Options:</label>
			<button type="button" class="btn btn-primary" onclick="addOption()">+ Add Option</button>
			<br />
			<div id="optionsContainer">
				<div class="option-item btn-group">
					<input class="form-control" type="text" name="optionText[]" placeholder="Option Text">
					<button type="button" class="remove-btn btn btn-close btn-danger" onclick="removeItem(this)"></button>
				</div>
			</div>
		</div>

		<div class="form-section col">
			<label class="form-label">Rating Scale Items:</label>
			<button type="button" class="add-btn btn btn-primary" onclick="addRatingItem()">+ Add Rating Item</button>
			<br />
			<div id="ratingScaleContainer">
				<div class="rating-item btn-group">
					<input class="form-control" type="text" name="ratingItemText[]" placeholder="Rating Item Text">
					<button class="remove-btn btn btn-close btn-danger" type="button" onclick="removeItem(this)"></button>
				</div>
			</div>
		</div>
	</div>
</form>

@section Scripts {
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script>
		// Add dynamic option field
		function addOption() {
			$('#optionsContainer').append(`
				<div class="option-item btn-group">
					<input class="form-control" type="text" name="optionText[]" placeholder="Option Text">
					<button type="button" class="remove-btn btn btn-close btn-danger" onclick="removeItem(this)"></button>
				</div>
			`);
		}

		// Add dynamic rating scale item field
		function addRatingItem() {
			$('#ratingScaleContainer').append(`
				<div class="rating-item btn-group">
					<input class="form-control" type="text" name="ratingItemText[]" placeholder="Rating Item Text">
					<button type="button" class="remove-btn btn btn-close btn-danger" onclick="removeItem(this)"></button>
				</div>
			`);
		}

		// Remove the parent element (option or rating item)
		function removeItem(button) {
			$(button).parent().remove();
		}

		// Submit form using jQuery AJAX
		function submitForm() {
			const formData = {
				text: $('#text').val(),
				type: parseInt($('#type').val()),
				sortOrder: parseFloat($('#sortOrder').val()),
				isShowable: parseInt($('#isShowable').val()) ? true : false,
				options: [],
				ratingScaleItems: []
			};

			// Collect options
			$('[name="optionText[]"]').each(function () {
				if ($(this).val().trim()) {
					formData.options.push({ optionText: $(this).val().trim() });
				}
			});

			// Collect rating scale items
			$('[name="ratingItemText[]"]').each(function () {
				if ($(this).val().trim()) {
					formData.ratingScaleItems.push({ itemText: $(this).val().trim() });
				}
			});

			console.log('Submitting data:', JSON.stringify(formData, null, 2));

			$.ajax({
				url: '/Question/Create',  // <- Your backend endpoint
				type: 'POST',
				contentType: 'application/json',
				data: JSON.stringify(formData),
				success: function (response) {
					Swal.fire({
						title: 'Success!',
						text: response.message || 'Question created successfully!',
						icon: 'success',
						confirmButtonText: 'OK'
					}).then((result) => {
						if (result.isConfirmed) {
							location.reload();  // Page reload only if OK is pressed
						}
					});
				},
				error: function (xhr) {
					const errorResponse = xhr.responseJSON || { message: 'An error occurred' };
					alert('Error: ' + errorResponse.message);
					console.error('Error response:', xhr);
				}
			});
		}
	</script>
}
